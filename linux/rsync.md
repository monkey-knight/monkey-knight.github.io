# `rsync` 实现远程同步和本地复制

## 一. 使用详解

#### 1. 命令的安装

如果 `Ubuntu` 系统上没有安装 `rsync` 工具, 可以使用如下方式安装:

```shell
sudo apt-get install rsync
```

#### 2. 命令的格式

- ```shell
  rsync [参数列表] src dest
  ```

- ```shell
  rsync [参数列表] src [user@]host:dest
  ```

- ```shell
  rsync [参数列表] [user@]host:src dest
  ```

#### 3. 命令参数

```
-a, --archive		归档模式,相当于 -rlptgoD
```

```
-v, --verbose		详细信息输出
```

```
-p, --perms			保持文件的权限
```

```
-g, --group			保持文件 group 信息
```

```
-o, --owner			保持文件 owner 信息
```

```
-l, --links			保留软链接
```

```
-H, --hard-links	保留硬链接
```

```
-t, --times			保留修改时间
```

```
-r, --recursive		对目录以递归模式处理
```

```
-e, --rsh=COMMAND	指定是使用 rsh 方式还是 ssh 方式进行数据同步
```

```
-z, --compress		对备份的文件在传输的过程中进行压缩处理
```

```
--progress			打印同步过程的进度
```

```
--exclude			指定同步时需要过滤掉的文件或者子目录;如果需过滤多个文件或子目录,可以多个--exclude一起使用
```

```
--version			打印 rysnc 的版本信息
```

#### 4. 命令的使用

最常使用的命令方式一般可能会比较像如下命令:

```shell
rsync -e "ssh -p 44436" -av --progress zzw@59.71.237.53:/src/ /dest/
```

如上命令的表达的含义是: `-e "ssh -p 44436"` 表示以 `ssh` 的方式进行数据同步, 并且主机`zzw@59.71.237.53`端口为`44436`, 将`/src/`目录下的所有文件同步到本地的`/dest/`目录下.



## 二. 与 `scp` 比较 

`scp` 命令的具体使用方法在这里不再赘述，[详情可以在这里查看]()。下面详细讲解一下两个之间的异同点: 

`scp` 是 `secure copy` 的简写，用于在Linux下进行远程拷贝文件的命令，和它类似的命令有 `cp`，不过 `cp` 只是在本机进行拷贝不能跨服务器，而且 `scp` 传输是加密的。可能会稍微影响一下速度。当你服务器硬盘变为只读时，用 `scp` 可以帮你把文件移出来。另外，`scp` 还非常不占资源，不会提高多少系统负荷，在这一点上，`rsync` 就远远不及它了。虽然 `rsync` 比 `scp` 会快一点，但当小文件众多的情况下，`rsync` 会导致硬盘I/O非常高，而`scp` 基本不影响系统正常使用。`scp` 在夸机器复制的时候为了提高数据的安全性，使用了 `ssh` 连接和加密方式，如果机器之间配置了 `ssh` 免密码登录，那在使用 `scp` 的时候密码都不用输入。

一般而言，我们会选择使用 `rsync` 进行远程同步或拷贝。`rsync` 和 `scp` 的区别在于：

- `rsync` 只对差异文件做更新，可以做增量或全量备份；而 `scp` 只能做全量备份。简单说就是 `rsync` 只传修改了的部分，如果改动较小就不需要全部重传，所以 `rsync` 备份速度较快；默认情况下，`rsync`  通过比较文件的最后修改时间（`mtime` ）和文件的大小（`size`）来确认哪些文件需要被同步过去;
- `rsync` 是分块校验+传输，`scp` 是整个文件传输。`rsync` 比 `scp` 有优势的地方在于单个大文件的一小部分存在改动时，只需传输改动部分，无需重新传输整个文件。如果传输一个新的文件，理论上 `rsync` 没有优势;
- `rsync` 不是加密传输，而 `scp` 是加密传输，使用时可以按需选择。